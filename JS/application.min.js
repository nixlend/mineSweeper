function updateInfo(){var openedGrid=$(".board > .opened-box").length,flag=$(".board .fa-flag").length,bomb=$(".board .fa-bomb.hide-icon").length-flag;$(".info-bar .info-opened-box").closest(".top-icon").find("span:last").text(openedGrid),$(".info-bar .fa-flag").closest(".top-icon").find("span:last").text(flag),$(".info-bar .fa-bomb").closest(".top-icon").find("span:last").text(bomb)}function bfs(graph,id){for(var bfsInfo=[],i=0;i<graph.length;i++)bfsInfo[i]={distance:null,parent:null};bfsInfo[id].distance=0;var bfsQueue=new Queue;for(bfsQueue.enqueue(id);!bfsQueue.isEmpty();)for(var currentId=bfsQueue.dequeue(),i=0;i<graph[currentId].length;i++){var neighbour=graph[currentId][i];null===bfsInfo[neighbour].distance&&(bfsInfo[neighbour].distance=bfsInfo[currentId].distance+1,bfsInfo[neighbour].parent=currentId,bfsQueue.enqueue(neighbour))}return bfsInfo}function filterEdgeGrid(id){var position=[id-9,id-8,id-7,id+1,id+9,id+8,id+7,id-1];return id%8==0&&(position[0]=-1,position[7]=-1,position[6]=-1),(id+1)%8==0&&(position[2]=-1,position[3]=-1,position[4]=-1),id>=0&&id<=7&&(position[0]=-1,position[1]=-1,position[2]=-1),id>=56&&id<=63&&(position[6]=-1,position[5]=-1,position[4]=-1),position}function findNeighbours(){for(var listOfNeighboursArray=[],i=0;i<64;i++){var neighboursArray=[];if(0==$("#"+i).children().length||$("#"+i).children("i:last").hasClass(""))for(var position=filterEdgeGrid(i),j=0;j<8;j++)position[j]>=0&&(0==$("#"+position[j]).children().length||$("#"+position[j]).children("i:last").hasClass("")||$("#"+position[j]).children("p").length>0)&&!$("#"+position[j]).children("i:last").hasClass("fa-flag")&&neighboursArray.push(position[j]);listOfNeighboursArray.push(neighboursArray.sort(function(a,b){return a-b}))}return listOfNeighboursArray}function isWon(){var openedGrid=$(".board > .opened-box").length,flag=$(".board .fa-flag").length,bomb=$(".board .fa-bomb.hide-icon").length-flag;57==openedGrid&&7==flag&&0==bomb&&($(".restart").text("Congratulations, you won! Play again"),$(".restart").css({display:"inline-block",background:"#84f883"}))}function setup(){for(var mines=[],i=0;i<7;i++){let ran=Math.floor(64*Math.random());-1===mines.indexOf(ran)?mines.push(ran):i--}for(i=0;i<64;i++){var div=$("<div></div>");$(".board").append(div).find("div:last").attr({class:"box",id:i}),-1!==$.inArray(i,mines)&&$(".board").find("div:last").append("<i></i>").find("i").attr({class:"fa fa-bomb fa-2x hide-icon",ariaHidden:!0})}for(i=0;i<64;i++){if($("#"+i).children("i.fa-bomb").length>0)continue;let counter=0;for(var position=filterEdgeGrid(i),j=0;j<8;j++)position[j]>=0&&$("#"+position[j]).children("i.fa-bomb").length>0&&counter++;counter>0&&$("#"+i).append("<p>"+counter+"</p>").find("p").addClass("hide-icon")}var neighboursList=findNeighbours();return updateInfo(),[mines,neighboursList]}function padZero(val){return val<=9&&(val="0"+val),val}function runTimer(time){second=padZero(time%60),minute=padZero(parseInt(time/60)),$("#timing").text(minute+":"+second)}class Queue{constructor(){this.q=[]}enqueue(obj){this.q.push(obj)}dequeue(){return this.q.shift()}isEmpty(){return 0===this.q.length}}$(document).ready(function(){var interval,neighboursList,mines=[],timer=0,timeRunning=!1,starting=setup();mines=starting[0],neighboursList=starting[1],$(".board").on("click",".box",function(){if(timeRunning||(timeRunning=!0,interval=setInterval(function(){runTimer(timer++)},1e3)),!$(this).children().hasClass("fa-flag")){if($(this).children().hasClass("fa-bomb")&&(clearInterval(interval),$(".restart").css("display","inline-block")),0==$(this).children().length||1==$(this).children().length&&$(this).children("i:last").hasClass(""))for(var openList=bfs(neighboursList,this.id),i=0;i<openList.length;i++)null!=openList[i].distance&&$("#"+i).hasClass("box")&&($("#"+i).removeClass("box").addClass("opened-box"),$("#"+i).children().removeClass("hide-icon").addClass("show-icon"));$(this).removeClass("box").addClass("opened-box"),$(this).children().removeClass("hide-icon").addClass("show-icon"),updateInfo()}isWon()}),$(".board").on("contextmenu",".box",function(){return 0==$(this).children().length||1==$(this).children().length&&$(this).find("p").length||1==$(this).children().length&&$(this).find("i:last").hasClass("fa-bomb")?$(this).append("<i></i>").find("i:last").toggleClass("fa fa-flag fa-2x"):(2==$(this).children().length||1==$(this).children().length&&!$(this).find("i").hasClass("fa-bomb"))&&$(this).find("i:last").toggleClass("fa fa-flag fa-2x"),neighboursList=findNeighbours(),updateInfo(),isWon(),!1}),$(".restart").on("click",function(){timer=0,interval=null,timeRunning=!1,$("#timing").text("00:00"),$(".restart").text("You lose, play again"),$(".restart").css({display:"none",background:"#f88383"}),$(".board").empty(),starting=setup(),mines=starting[0],neighboursList=starting[1]})});